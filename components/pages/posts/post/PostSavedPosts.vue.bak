<template>
	<button
		class="link group my-2 flex items-center gap-2"
		type="button"
		@click="savePostClickHandler"
	>
		<span class="sr-only"> Save post </span>

		<HeartIcon
			:class="{
				'fill-current text-red-500 group-hover:text-red-400': isPostSaved
			}"
			class="icon h-5 w-5"
		/>

		Save
	</button>
</template>

<script setup>
import { computed } from 'vue'
import { useRouter } from 'vue-router'
import { useHead } from '@vueuse/head'
import { HeartIcon } from 'vue-feather-icons'

const props = defineProps({
	post: {
		type: Object,
		required: true
	}
})

const isPostSaved = computed(() => {
	const savedPosts = getCustomSavedPosts.value
	return savedPosts.some((POST) => POST.id === props.post.id)
})

const addPostToSavedPosts = (payload) => store.dispatch('user/addPostToSavedPosts', payload)
const removePostFromSavedPosts = (payload) => store.dispatch('user/removePostFromSavedPosts', payload)

const router = useRouter()

async function savePostClickHandler() {
	if (!isUserPremium.value) {
		await router.push({ name: 'premium' })
		return
	}

	if (isPostSaved.value) {
		await removePostFromSavedPosts({
			postId: props.post.id
		})
	} else {
		await addPostToSavedPosts({
			post: props.post
		})
	}
}

useHead({
	title: 'Post'
})
</script>
